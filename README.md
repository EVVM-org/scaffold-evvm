# Scaffold-EVVM

**The complete development environment for EVVM (Ethereum Virtual Virtual Machine) ecosystem.**

Scaffold-EVVM is your all-in-one toolkit for deploying, interacting with, and building services on EVVM. Choose between Foundry or Hardhat, deploy production-ready contracts from Testnet-Contracts or experimental ones from Playground-Contracts, and use the integrated frontend to construct and execute EVVM signatures.

---

## Features

- **Dual Framework Support** - Choose Foundry or Hardhat for smart contract development
- **Dual Contract Sources** - Deploy from Testnet-Contracts (production) or Playground-Contracts (experimental)
- **Interactive CLI Wizard** - Guided setup for framework, contracts, and configuration
- **Full Deployment Pipeline** - Deploy to local chains, Ethereum Sepolia, or Arbitrum Sepolia
- **Signature Constructor Frontend** - 23+ signature constructors for all EVVM operations
- **Auto Contract Discovery** - Discovers Staking, NameService, Estimator from EVVM core
- **Meta-Transaction Pattern** - EIP-191 gasless signatures submitted by executors
- **Registry Integration** - Register your EVVM instance in the global registry

---

## Quick Start

### One Command Setup

```bash
# Clone and install
git clone <your-repo-url>
cd scaffold-evvm
npm install

# Full setup in ONE command:
npm run start:full
```

This single command will:
1. Select framework (Foundry/Hardhat)
2. Select contracts (Testnet/Playground)
3. Configure EVVM (addresses, metadata)
4. Sync and compile contracts
5. Start local chain (if localhost)
6. Deploy contracts
7. Update frontend configuration
8. Start the frontend

### Prerequisites

- Node.js 18+ and npm
- Git
- Foundry (recommended) - Install: `curl -L https://foundry.paradigm.xyz | bash && foundryup`

### Alternative: Interactive Wizard

```bash
npm run wizard    # Step-by-step interactive setup
```

### Wizard Flow

The wizard guides you through:

1. **Framework Selection** - Foundry (fast, Solidity-native) or Hardhat (JS/TS ecosystem)
2. **Contract Source** - Testnet-Contracts or Playground-Contracts
3. **EVVM Configuration** - Admin addresses and token metadata
4. **Network Selection** - Local, Sepolia, Arbitrum, or custom RPC
5. **Deployment** - Automatic contract deployment and verification
6. **Registry Registration** - Optional global EVVM registry enrollment

---

## Project Structure

```
scaffold-evvm/
├── cli/                    # Interactive CLI wizard
│   ├── commands/           # CLI commands (init, deploy, chain, config)
│   ├── prompts/            # User prompts
│   └── utils/              # CLI utilities
├── packages/
│   ├── foundry/            # Foundry smart contracts package
│   │   ├── contracts/      # Synced from Testnet/Playground
│   │   ├── script/         # Deployment scripts
│   │   └── test/           # Foundry tests
│   ├── hardhat/            # Hardhat smart contracts package
│   │   ├── contracts/      # Synced from Testnet/Playground
│   │   ├── deploy/         # Hardhat-deploy scripts
│   │   └── test/           # Hardhat tests
│   └── nextjs/             # Frontend application
│       ├── src/app/        # Next.js pages
│       ├── src/components/ # Signature constructors
│       ├── src/hooks/      # React hooks
│       └── src/lib/        # Utilities
├── scripts/                # Build utilities
├── input/                  # EVVM configuration files
└── scaffold.config.json    # Project configuration
```

---

## Commands

### Wizard & CLI

```bash
npm run wizard          # Interactive setup wizard
npm run cli init        # Initialize project
npm run cli deploy      # Deploy contracts
npm run cli chain       # Start local chain
npm run cli config      # Update configuration
```

### Framework Commands

```bash
# Foundry
npm run foundry:chain   # Start Anvil local chain
npm run foundry:compile # Compile with Forge
npm run foundry:test    # Run Foundry tests
npm run foundry:deploy  # Deploy with Foundry

# Hardhat
npm run hardhat:chain   # Start Hardhat Network
npm run hardhat:compile # Compile with Hardhat
npm run hardhat:test    # Run Hardhat tests
npm run hardhat:deploy  # Deploy with Hardhat
```

### Frontend

```bash
npm run dev             # Start development server
npm run build           # Build for production
npm run start           # Start production server
```

### Utilities

```bash
npm run sync-contracts  # Sync from Testnet/Playground
npm run generate-abis   # Generate ABIs for frontend
```

---

## Configuration

### Environment Variables (.env)

```bash
# Frontend
NEXT_PUBLIC_PROJECT_ID=your_walletconnect_project_id
NEXT_PUBLIC_EVVM_ADDRESS=0x...deployed_evvm_address
NEXT_PUBLIC_CHAIN_ID=11155111  # or 421614 for Arbitrum

# Deployment
RPC_URL_ETH_SEPOLIA=https://1rpc.io/sepolia
RPC_URL_ARB_SEPOLIA=https://sepolia-rollup.arbitrum.io/rpc
ETHERSCAN_API=your_etherscan_api_key

# Hardhat (optional)
DEPLOYER_PRIVATE_KEY=0x...
```

### EVVM Configuration (input/)

Configuration files are generated by the wizard:

- `address.json` - Admin, Golden Fisher, Activator addresses
- `evvmBasicMetadata.json` - EVVM name, token name, symbol
- `evvmAdvancedMetadata.json` - Supply, era tokens, reward

---

## Contract Sources

### Testnet-Contracts

Production-ready EVVM contracts for testnet deployment:
- 6 core contracts: Evvm, Staking, Estimator, NameService, Treasury, P2PSwap
- Full test coverage
- Optimized for deployment

### Playground-Contracts

Experimental contracts for prototyping:
- Same 6 core contracts (development versions)
- Extensive unit and fuzz tests
- Ideal for testing new features

Sync contracts with:
```bash
npm run sync-contracts
```

---

## EVVM Core Concepts

### What is EVVM?

EVVM (Ethereum Virtual Virtual Machine) is a payment and identity system that uses meta-transactions (EIP-191 signatures) for gasless operations. Users sign messages off-chain, and executors ("fishers") submit transactions on-chain.

### Core Contracts

1. **Evvm** - Core payment system with dual-nonce meta-transactions
2. **Staking** - MATE token staking (golden, presale, public tiers)
3. **Estimator** - Staking rewards calculation
4. **NameService** - ENS-like identity system with offers and metadata
5. **Treasury** - Deposit/withdrawal management for ETH and ERC20
6. **P2PSwap** - Decentralized peer-to-peer token exchange

### Meta-Transaction Flow

```
1. User signs message off-chain (no gas cost)
2. Executor submits signed message on-chain
3. Contract verifies signature and executes
4. User receives result without paying gas
```

### Dual Nonce System

- **Sync Nonces** - Sequential, for ordered operations
- **Async Nonces** - Parallel, for independent operations

---

## Supported Networks

| Network | Chain ID | RPC |
|---------|----------|-----|
| Local (Anvil/Hardhat) | 31337 | http://localhost:8545 |
| Ethereum Sepolia | 11155111 | https://1rpc.io/sepolia |
| Arbitrum Sepolia | 421614 | https://sepolia-rollup.arbitrum.io/rpc |

---

## Signature Constructors

The frontend includes 23+ signature constructors:

### Payment Operations
- `signPay` - Single payment
- `signDispersePay` - Multiple payments
- `signPayMultiple` - Batch payments

### Staking Operations
- `signGoldenStaking` - Golden fisher tier
- `signPresaleStaking` - Presale tier
- `signPublicStaking` - Public tier
- `signPublicServiceStaking` - Service tier

### NameService Operations
- `signPreRegistrationUsername` - Reserve username
- `signRegistrationUsername` - Register username
- `signMakeOffer` - Make offer
- `signAcceptOffer` - Accept offer
- `signRenewUsername` - Renew registration
- And more...

### P2PSwap Operations
- `signMakeOrder` - Create swap order
- `signCancelOrder` - Cancel order
- `signDispatchOrderFill` - Fill order

---

## Development

### Adding a New Contract

1. Add contract to source repository (Testnet or Playground)
2. Run `npm run sync-contracts`
3. Update deployment script in `packages/foundry/script/` or `packages/hardhat/deploy/`
4. Run `npm run generate-abis` after compilation
5. Add frontend components in `packages/nextjs/src/components/`

### Testing

```bash
# Foundry tests
cd packages/foundry && forge test -vvv

# Hardhat tests
cd packages/hardhat && npx hardhat test

# Run specific test
forge test --match-test testFunctionName -vvv
```

---

## Documentation

- [EVVM Documentation](https://www.evvm.info/docs)
- [EVVM Signature Structures](https://www.evvm.org/docs/SignatureStructures/)
- [Foundry Book](https://book.getfoundry.sh/)
- [Hardhat Docs](https://hardhat.org/docs)
- [@evvm/viem-signature-library](https://www.npmjs.com/package/@evvm/viem-signature-library)

---

## Security

- Never commit `.env` files with real keys
- All signing happens client-side
- Use Foundry keystore for secure key management
- Contracts not audited for mainnet use

---

## License

MIT License - see [LICENSE](LICENSE) for details

---

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make changes following the commit message convention
4. Submit a pull request

---

Made for the EVVM ecosystem
